{
  "version": "1.12.0",
  "compound": {
    "kind": "page",
    "id": "example_j_page",
    "name": "Example J: Using External Interrupts",
    "url_base": "example_j_page",
    "url": "example_j_page.html",
    "include": null,
    "has_template_details": false,
    "templates": null,
    "brief": "",
    "description": "<p><a name=\"md_examples_2j__external__pcint__library_2_read_me\"></a></p><p>This is identical to example D, except that instead of using internal definitions of pin change interrupt vectors, it depends on another library to define them for it.</p><p>To use this example, you must remove the comment braces around <code>#define SDI12_EXTERNAL_PCINT</code> in the library and re-compile it.</p><section id=\"j_external_pcint_library_pio\"><h2>PlatformIO Configuration</h2><div class=\"m-code-pygments-default\"><div class=\"highlight\"><div class=\"line\"><a id=\"l-1\" name=\"l-1\"></a><span class=\"linenos\"> 1</span><span class=\"c1\">; PlatformIO Project Configuration File</span>\n</div><div class=\"line\"><a id=\"l-2\" name=\"l-2\"></a><span class=\"linenos\"> 2</span>\n</div><div class=\"line\"><a id=\"l-3\" name=\"l-3\"></a><span class=\"linenos\"> 3</span><span class=\"k\">[platformio]</span>\n</div><div class=\"line\"><a id=\"l-4\" name=\"l-4\"></a><span class=\"linenos\"> 4</span><span class=\"na\">description</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">SDI-12 Library Example J:  Using an External Interrupt Library</span>\n</div><div class=\"line\"><a id=\"l-5\" name=\"l-5\"></a><span class=\"linenos\"> 5</span><span class=\"na\">src_dir</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">.piolibdeps/Arduino-SDI-12_ID1486/examples/j_external_pcint_library</span>\n</div><div class=\"line\"><a id=\"l-6\" name=\"l-6\"></a><span class=\"linenos\"> 6</span>\n</div><div class=\"line\"><a id=\"l-7\" name=\"l-7\"></a><span class=\"linenos\"> 7</span><span class=\"k\">[env:mayfly]</span>\n</div><div class=\"line\"><a id=\"l-8\" name=\"l-8\"></a><span class=\"linenos\"> 8</span><span class=\"na\">monitor_speed</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">115200</span>\n</div><div class=\"line\"><a id=\"l-9\" name=\"l-9\"></a><span class=\"linenos\"> 9</span><span class=\"na\">board</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">mayfly</span>\n</div><div class=\"line\"><a id=\"l-10\" name=\"l-10\"></a><span class=\"linenos\">10</span><span class=\"na\">platform</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">atmelavr</span>\n</div><div class=\"line\"><a id=\"l-11\" name=\"l-11\"></a><span class=\"linenos\">11</span><span class=\"na\">framework</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">arduino</span>\n</div><div class=\"line\"><a id=\"l-12\" name=\"l-12\"></a><span class=\"linenos\">12</span><span class=\"na\">lib_ldf_mode</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">deep+</span>\n</div><div class=\"line\"><a id=\"l-13\" name=\"l-13\"></a><span class=\"linenos\">13</span><span class=\"na\">lib_ignore</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">RTCZero</span>\n</div><div class=\"line\"><a id=\"l-14\" name=\"l-14\"></a><span class=\"linenos\">14</span><span class=\"na\">build_flags</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-15\" name=\"l-15\"></a><span class=\"linenos\">15</span><span class=\"w\">    </span><span class=\"na\">-DSDI12_EXTERNAL_PCINT</span>\n</div><div class=\"line\"><a id=\"l-16\" name=\"l-16\"></a><span class=\"linenos\">16</span><span class=\"na\">lib_deps</span><span class=\"w\"> </span><span class=\"o\">=</span>\n</div><div class=\"line\"><a id=\"l-17\" name=\"l-17\"></a><span class=\"linenos\">17</span><span class=\"w\">    </span><span class=\"na\">SDI-12</span>\n</div><div class=\"line\"><a id=\"l-18\" name=\"l-18\"></a><span class=\"linenos\">18</span><span class=\"w\">    </span><span class=\"na\">EnableInterrupt</span>\n</div></div></div></section><section id=\"j_external_pcint_library_code\"><h2>The Complete Example</h2><div class=\"m-code-arduino\"><div class=\"highlight\"><div class=\"line\"><a id=\"l-1\" name=\"l-1\"></a><span class=\"linenos\">  1</span><span class=\"cm\">/**</span>\n</div><div class=\"line\"><a id=\"l-2\" name=\"l-2\"></a><span class=\"linenos\">  2</span><span class=\"cm\"> * @example{lineno} j_external_pcint_library.ino</span>\n</div><div class=\"line\"><a id=\"l-3\" name=\"l-3\"></a><span class=\"linenos\">  3</span><span class=\"cm\"> * @copyright Stroud Water Research Center</span>\n</div><div class=\"line\"><a id=\"l-4\" name=\"l-4\"></a><span class=\"linenos\">  4</span><span class=\"cm\"> * @license This example is published under the BSD-3 license.</span>\n</div><div class=\"line\"><a id=\"l-5\" name=\"l-5\"></a><span class=\"linenos\">  5</span><span class=\"cm\"> * @author Kevin M.Smith &lt;SDI12@ethosengineering.org&gt;</span>\n</div><div class=\"line\"><a id=\"l-6\" name=\"l-6\"></a><span class=\"linenos\">  6</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-7\" name=\"l-7\"></a><span class=\"linenos\">  7</span><span class=\"cm\"> * @brief Example J: Using External Interrupts</span>\n</div><div class=\"line\"><a id=\"l-8\" name=\"l-8\"></a><span class=\"linenos\">  8</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-9\" name=\"l-9\"></a><span class=\"linenos\">  9</span><span class=\"cm\"> * This is identical to example B, except that it uses the library</span>\n</div><div class=\"line\"><a id=\"l-10\" name=\"l-10\"></a><span class=\"linenos\"> 10</span><span class=\"cm\"> * [EnableInterrupt](https://github.com/GreyGnome/EnableInterrupt) to assign the pin</span>\n</div><div class=\"line\"><a id=\"l-11\" name=\"l-11\"></a><span class=\"linenos\"> 11</span><span class=\"cm\"> * change interrupt vector. This allows it to play nicely with any other libraries that</span>\n</div><div class=\"line\"><a id=\"l-12\" name=\"l-12\"></a><span class=\"linenos\"> 12</span><span class=\"cm\"> * try to assign functionality to the pin change interrupt vectors.</span>\n</div><div class=\"line\"><a id=\"l-13\" name=\"l-13\"></a><span class=\"linenos\"> 13</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-14\" name=\"l-14\"></a><span class=\"linenos\"> 14</span><span class=\"cm\"> * For this to work, you must remove the comment braces around</span>\n</div><div class=\"line\"><a id=\"l-15\" name=\"l-15\"></a><span class=\"linenos\"> 15</span><span class=\"cm\"> * `#define SDI12_EXTERNAL_PCINT` in the library and re-compile it.</span>\n</div><div class=\"line\"><a id=\"l-16\" name=\"l-16\"></a><span class=\"linenos\"> 16</span><span class=\"cm\"> */</span>\n</div><div class=\"line\"><a id=\"l-17\" name=\"l-17\"></a><span class=\"linenos\"> 17</span>\n</div><div class=\"line\"><a id=\"l-18\" name=\"l-18\"></a><span class=\"linenos\"> 18</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;EnableInterrupt.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-19\" name=\"l-19\"></a><span class=\"linenos\"> 19</span><span class=\"cp\">#include</span><span class=\"w\"> </span><span class=\"cpf\">&lt;SDI12.h&gt;</span>\n</div><div class=\"line\"><a id=\"l-20\" name=\"l-20\"></a><span class=\"linenos\"> 20</span>\n</div><div class=\"line\"><a id=\"l-21\" name=\"l-21\"></a><span class=\"linenos\"> 21</span><span class=\"cm\">/* connection information */</span>\n</div><div class=\"line\"><a id=\"l-22\" name=\"l-22\"></a><span class=\"linenos\"> 22</span><span class=\"kr\">uint32_t</span><span class=\"w\"> </span><span class=\"n\">serialBaud</span><span class=\"w\">   </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">115200</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"cm\">/*!&lt; The baud rate for the output serial port */</span>\n</div><div class=\"line\"><a id=\"l-23\" name=\"l-23\"></a><span class=\"linenos\"> 23</span><span class=\"kr\">int8_t</span><span class=\"w\">   </span><span class=\"n\">dataPin</span><span class=\"w\">      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">7</span><span class=\"p\">;</span><span class=\"w\">      </span><span class=\"cm\">/*!&lt; The pin of the SDI-12 data bus */</span>\n</div><div class=\"line\"><a id=\"l-24\" name=\"l-24\"></a><span class=\"linenos\"> 24</span><span class=\"kr\">int8_t</span><span class=\"w\">   </span><span class=\"n\">powerPin</span><span class=\"w\">     </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">22</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"cm\">/*!&lt; The sensor power pin (or -1 if not switching power) */</span>\n</div><div class=\"line\"><a id=\"l-25\" name=\"l-25\"></a><span class=\"linenos\"> 25</span><span class=\"kr\">int8_t</span><span class=\"w\">   </span><span class=\"n\">firstAddress</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"cm\">/* The first address in the address space to check (0=&#39;0&#39;) */</span>\n</div><div class=\"line\"><a id=\"l-26\" name=\"l-26\"></a><span class=\"linenos\"> 26</span><span class=\"kr\">int8_t</span><span class=\"w\">   </span><span class=\"n\">lastAddress</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"cm\">/* The last address in the address space to check (62=&#39;z&#39;) */</span>\n</div><div class=\"line\"><a id=\"l-27\" name=\"l-27\"></a><span class=\"linenos\"> 27</span>\n</div><div class=\"line\"><a id=\"l-28\" name=\"l-28\"></a><span class=\"linenos\"> 28</span><span class=\"cm\">/** Define the SDI-12 bus */</span>\n</div><div class=\"line\"><a id=\"l-29\" name=\"l-29\"></a><span class=\"linenos\"> 29</span><span class=\"n\">SDI12</span><span class=\"w\"> </span><span class=\"nf\">mySDI12</span><span class=\"p\">(</span><span class=\"n\">dataPin</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-30\" name=\"l-30\"></a><span class=\"linenos\"> 30</span>\n</div><div class=\"line\"><a id=\"l-31\" name=\"l-31\"></a><span class=\"linenos\"> 31</span><span class=\"c1\">// keeps track of active addresses</span>\n</div><div class=\"line\"><a id=\"l-32\" name=\"l-32\"></a><span class=\"linenos\"> 32</span><span class=\"kr\">bool</span><span class=\"w\"> </span><span class=\"n\">isActive</span><span class=\"p\">[</span><span class=\"mi\">64</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-33\" name=\"l-33\"></a><span class=\"linenos\"> 33</span><span class=\"w\">  </span><span class=\"mi\">0</span><span class=\"p\">,</span>\n</div><div class=\"line\"><a id=\"l-34\" name=\"l-34\"></a><span class=\"linenos\"> 34</span><span class=\"p\">};</span>\n</div><div class=\"line\"><a id=\"l-35\" name=\"l-35\"></a><span class=\"linenos\"> 35</span>\n</div><div class=\"line\"><a id=\"l-36\" name=\"l-36\"></a><span class=\"linenos\"> 36</span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">numSensors</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-37\" name=\"l-37\"></a><span class=\"linenos\"> 37</span>\n</div><div class=\"line\"><a id=\"l-38\" name=\"l-38\"></a><span class=\"linenos\"> 38</span><span class=\"cm\">/**</span>\n</div><div class=\"line\"><a id=\"l-39\" name=\"l-39\"></a><span class=\"linenos\"> 39</span><span class=\"cm\"> * @brief converts allowable address characters (&#39;0&#39;-&#39;9&#39;, &#39;a&#39;-&#39;z&#39;, &#39;A&#39;-&#39;Z&#39;) to a</span>\n</div><div class=\"line\"><a id=\"l-40\" name=\"l-40\"></a><span class=\"linenos\"> 40</span><span class=\"cm\"> * decimal number between 0 and 61 (inclusive) to cover the 62 possible</span>\n</div><div class=\"line\"><a id=\"l-41\" name=\"l-41\"></a><span class=\"linenos\"> 41</span><span class=\"cm\"> * addresses.</span>\n</div><div class=\"line\"><a id=\"l-42\" name=\"l-42\"></a><span class=\"linenos\"> 42</span><span class=\"cm\"> */</span>\n</div><div class=\"line\"><a id=\"l-43\" name=\"l-43\"></a><span class=\"linenos\"> 43</span><span class=\"kr\">byte</span><span class=\"w\"> </span><span class=\"nf\">charToDec</span><span class=\"p\">(</span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-44\" name=\"l-44\"></a><span class=\"linenos\"> 44</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;0&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;9&#39;</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"sc\">&#39;0&#39;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-45\" name=\"l-45\"></a><span class=\"linenos\"> 45</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;a&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;z&#39;</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"sc\">&#39;a&#39;</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-46\" name=\"l-46\"></a><span class=\"linenos\"> 46</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;A&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;Z&#39;</span><span class=\"p\">))</span>\n</div><div class=\"line\"><a id=\"l-47\" name=\"l-47\"></a><span class=\"linenos\"> 47</span><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"sc\">&#39;A&#39;</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-48\" name=\"l-48\"></a><span class=\"linenos\"> 48</span><span class=\"w\">  </span><span class=\"k\">else</span>\n</div><div class=\"line\"><a id=\"l-49\" name=\"l-49\"></a><span class=\"linenos\"> 49</span><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-50\" name=\"l-50\"></a><span class=\"linenos\"> 50</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-51\" name=\"l-51\"></a><span class=\"linenos\"> 51</span>\n</div><div class=\"line\"><a id=\"l-52\" name=\"l-52\"></a><span class=\"linenos\"> 52</span><span class=\"cm\">/**</span>\n</div><div class=\"line\"><a id=\"l-53\" name=\"l-53\"></a><span class=\"linenos\"> 53</span><span class=\"cm\"> * @brief maps a decimal number between 0 and 61 (inclusive) to allowable</span>\n</div><div class=\"line\"><a id=\"l-54\" name=\"l-54\"></a><span class=\"linenos\"> 54</span><span class=\"cm\"> * address characters &#39;0&#39;-&#39;9&#39;, &#39;a&#39;-&#39;z&#39;, &#39;A&#39;-&#39;Z&#39;,</span>\n</div><div class=\"line\"><a id=\"l-55\" name=\"l-55\"></a><span class=\"linenos\"> 55</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-56\" name=\"l-56\"></a><span class=\"linenos\"> 56</span><span class=\"cm\"> * THIS METHOD IS UNUSED IN THIS EXAMPLE, BUT IT MAY BE HELPFUL.</span>\n</div><div class=\"line\"><a id=\"l-57\" name=\"l-57\"></a><span class=\"linenos\"> 57</span><span class=\"cm\"> */</span>\n</div><div class=\"line\"><a id=\"l-58\" name=\"l-58\"></a><span class=\"linenos\"> 58</span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"nf\">decToChar</span><span class=\"p\">(</span><span class=\"kr\">byte</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-59\" name=\"l-59\"></a><span class=\"linenos\"> 59</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"sc\">&#39;0&#39;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-60\" name=\"l-60\"></a><span class=\"linenos\"> 60</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"sc\">&#39;a&#39;</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-61\" name=\"l-61\"></a><span class=\"linenos\"> 61</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"mi\">62</span><span class=\"p\">))</span>\n</div><div class=\"line\"><a id=\"l-62\" name=\"l-62\"></a><span class=\"linenos\"> 62</span><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"sc\">&#39;A&#39;</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">36</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-63\" name=\"l-63\"></a><span class=\"linenos\"> 63</span><span class=\"w\">  </span><span class=\"k\">else</span>\n</div><div class=\"line\"><a id=\"l-64\" name=\"l-64\"></a><span class=\"linenos\"> 64</span><span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-65\" name=\"l-65\"></a><span class=\"linenos\"> 65</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-66\" name=\"l-66\"></a><span class=\"linenos\"> 66</span>\n</div><div class=\"line\"><a id=\"l-67\" name=\"l-67\"></a><span class=\"linenos\"> 67</span><span class=\"cm\">/**</span>\n</div><div class=\"line\"><a id=\"l-68\" name=\"l-68\"></a><span class=\"linenos\"> 68</span><span class=\"cm\"> * @brief gets identification information from a sensor, and prints it to the serial</span>\n</div><div class=\"line\"><a id=\"l-69\" name=\"l-69\"></a><span class=\"linenos\"> 69</span><span class=\"cm\"> * port</span>\n</div><div class=\"line\"><a id=\"l-70\" name=\"l-70\"></a><span class=\"linenos\"> 70</span><span class=\"cm\"> *</span>\n</div><div class=\"line\"><a id=\"l-71\" name=\"l-71\"></a><span class=\"linenos\"> 71</span><span class=\"cm\"> * @param i a character between &#39;0&#39;-&#39;9&#39;, &#39;a&#39;-&#39;z&#39;, or &#39;A&#39;-&#39;Z&#39;.</span>\n</div><div class=\"line\"><a id=\"l-72\" name=\"l-72\"></a><span class=\"linenos\"> 72</span><span class=\"cm\"> */</span>\n</div><div class=\"line\"><a id=\"l-73\" name=\"l-73\"></a><span class=\"linenos\"> 73</span><span class=\"kr\">void</span><span class=\"w\"> </span><span class=\"nf\">printInfo</span><span class=\"p\">(</span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-74\" name=\"l-74\"></a><span class=\"linenos\"> 74</span><span class=\"w\">  </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-75\" name=\"l-75\"></a><span class=\"linenos\"> 75</span><span class=\"w\">  </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kr\">char</span><span class=\"p\">)</span><span class=\"n\">i</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-76\" name=\"l-76\"></a><span class=\"linenos\"> 76</span><span class=\"w\">  </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"s\">&quot;I!&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-77\" name=\"l-77\"></a><span class=\"linenos\"> 77</span><span class=\"w\">  </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">sendCommand</span><span class=\"p\">(</span><span class=\"n\">command</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-78\" name=\"l-78\"></a><span class=\"linenos\"> 78</span><span class=\"w\">  </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-79\" name=\"l-79\"></a><span class=\"linenos\"> 79</span>\n</div><div class=\"line\"><a id=\"l-80\" name=\"l-80\"></a><span class=\"linenos\"> 80</span><span class=\"w\">  </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">sdiResponse</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">readStringUntil</span><span class=\"p\">(</span><span class=\"sc\">&#39;\\n&#39;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-81\" name=\"l-81\"></a><span class=\"linenos\"> 81</span><span class=\"w\">  </span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">trim</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-82\" name=\"l-82\"></a><span class=\"linenos\"> 82</span><span class=\"w\">  </span><span class=\"c1\">// allccccccccmmmmmmvvvxxx...xx&lt;CR&gt;&lt;LF&gt;</span>\n</div><div class=\"line\"><a id=\"l-83\" name=\"l-83\"></a><span class=\"linenos\"> 83</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">));</span><span class=\"w\">  </span><span class=\"c1\">// address</span>\n</div><div class=\"line\"><a id=\"l-84\" name=\"l-84\"></a><span class=\"linenos\"> 84</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-85\" name=\"l-85\"></a><span class=\"linenos\"> 85</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">).</span><span class=\"n\">toFloat</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// SDI-12 version number</span>\n</div><div class=\"line\"><a id=\"l-86\" name=\"l-86\"></a><span class=\"linenos\"> 86</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-87\" name=\"l-87\"></a><span class=\"linenos\"> 87</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">11</span><span class=\"p\">));</span><span class=\"w\">  </span><span class=\"c1\">// vendor id</span>\n</div><div class=\"line\"><a id=\"l-88\" name=\"l-88\"></a><span class=\"linenos\"> 88</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-89\" name=\"l-89\"></a><span class=\"linenos\"> 89</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">17</span><span class=\"p\">));</span><span class=\"w\">  </span><span class=\"c1\">// sensor model</span>\n</div><div class=\"line\"><a id=\"l-90\" name=\"l-90\"></a><span class=\"linenos\"> 90</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-91\" name=\"l-91\"></a><span class=\"linenos\"> 91</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">17</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">20</span><span class=\"p\">));</span><span class=\"w\">  </span><span class=\"c1\">// sensor version</span>\n</div><div class=\"line\"><a id=\"l-92\" name=\"l-92\"></a><span class=\"linenos\"> 92</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-93\" name=\"l-93\"></a><span class=\"linenos\"> 93</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">));</span><span class=\"w\">  </span><span class=\"c1\">// sensor id</span>\n</div><div class=\"line\"><a id=\"l-94\" name=\"l-94\"></a><span class=\"linenos\"> 94</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-95\" name=\"l-95\"></a><span class=\"linenos\"> 95</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-96\" name=\"l-96\"></a><span class=\"linenos\"> 96</span>\n</div><div class=\"line\"><a id=\"l-97\" name=\"l-97\"></a><span class=\"linenos\"> 97</span><span class=\"kr\">bool</span><span class=\"w\"> </span><span class=\"nf\">getResults</span><span class=\"p\">(</span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">int</span><span class=\"w\"> </span><span class=\"n\">resultsExpected</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-98\" name=\"l-98\"></a><span class=\"linenos\"> 98</span><span class=\"w\">  </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">resultsReceived</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-99\" name=\"l-99\"></a><span class=\"linenos\"> 99</span><span class=\"w\">  </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">cmd_number</span><span class=\"w\">      </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-100\" name=\"l-100\"></a><span class=\"linenos\">100</span><span class=\"w\">  </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">resultsReceived</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">resultsExpected</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">cmd_number</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"mi\">9</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-101\" name=\"l-101\"></a><span class=\"linenos\">101</span><span class=\"w\">    </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-102\" name=\"l-102\"></a><span class=\"linenos\">102</span><span class=\"w\">    </span><span class=\"c1\">// in this example we will only take the &#39;DO&#39; measurement</span>\n</div><div class=\"line\"><a id=\"l-103\" name=\"l-103\"></a><span class=\"linenos\">103</span><span class=\"w\">    </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-104\" name=\"l-104\"></a><span class=\"linenos\">104</span><span class=\"w\">    </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-105\" name=\"l-105\"></a><span class=\"linenos\">105</span><span class=\"w\">    </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"s\">&quot;D&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-106\" name=\"l-106\"></a><span class=\"linenos\">106</span><span class=\"w\">    </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">cmd_number</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-107\" name=\"l-107\"></a><span class=\"linenos\">107</span><span class=\"w\">    </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"s\">&quot;!&quot;</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// SDI-12 command to get data [address][D][dataOption][!]</span>\n</div><div class=\"line\"><a id=\"l-108\" name=\"l-108\"></a><span class=\"linenos\">108</span><span class=\"w\">    </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">sendCommand</span><span class=\"p\">(</span><span class=\"n\">command</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-109\" name=\"l-109\"></a><span class=\"linenos\">109</span>\n</div><div class=\"line\"><a id=\"l-110\" name=\"l-110\"></a><span class=\"linenos\">110</span><span class=\"w\">    </span><span class=\"kr\">uint32_t</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">millis</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-111\" name=\"l-111\"></a><span class=\"linenos\">111</span><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">available</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nf\">millis</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">1500</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{}</span>\n</div><div class=\"line\"><a id=\"l-112\" name=\"l-112\"></a><span class=\"linenos\">112</span><span class=\"w\">    </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">();</span><span class=\"w\">           </span><span class=\"c1\">// ignore the repeated SDI12 address</span>\n</div><div class=\"line\"><a id=\"l-113\" name=\"l-113\"></a><span class=\"linenos\">113</span><span class=\"w\">    </span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">peek</span><span class=\"p\">();</span><span class=\"w\">  </span><span class=\"c1\">// check if there&#39;s a &#39;+&#39; and toss if so</span>\n</div><div class=\"line\"><a id=\"l-114\" name=\"l-114\"></a><span class=\"linenos\">114</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">&#39;+&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">();</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-115\" name=\"l-115\"></a><span class=\"linenos\">115</span>\n</div><div class=\"line\"><a id=\"l-116\" name=\"l-116\"></a><span class=\"linenos\">116</span><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">available</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-117\" name=\"l-117\"></a><span class=\"linenos\">117</span><span class=\"w\">      </span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">peek</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-118\" name=\"l-118\"></a><span class=\"linenos\">118</span><span class=\"w\">      </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">&#39;-&#39;</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;0&#39;</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">&lt;=</span><span class=\"w\"> </span><span class=\"sc\">&#39;9&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">&#39;.&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-119\" name=\"l-119\"></a><span class=\"linenos\">119</span><span class=\"w\">        </span><span class=\"kr\">float</span><span class=\"w\"> </span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">parseFloat</span><span class=\"p\">(</span><span class=\"n\">SKIP_NONE</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-120\" name=\"l-120\"></a><span class=\"linenos\">120</span><span class=\"w\">        </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"kr\">String</span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">10</span><span class=\"p\">));</span>\n</div><div class=\"line\"><a id=\"l-121\" name=\"l-121\"></a><span class=\"linenos\">121</span><span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">result</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"mi\">-9999</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"n\">resultsReceived</span><span class=\"o\">++</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-122\" name=\"l-122\"></a><span class=\"linenos\">122</span><span class=\"w\">      </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">&#39;+&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-123\" name=\"l-123\"></a><span class=\"linenos\">123</span><span class=\"w\">        </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-124\" name=\"l-124\"></a><span class=\"linenos\">124</span><span class=\"w\">        </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-125\" name=\"l-125\"></a><span class=\"linenos\">125</span><span class=\"w\">      </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-126\" name=\"l-126\"></a><span class=\"linenos\">126</span><span class=\"w\">        </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-127\" name=\"l-127\"></a><span class=\"linenos\">127</span><span class=\"w\">      </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-128\" name=\"l-128\"></a><span class=\"linenos\">128</span><span class=\"w\">      </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// 1 character ~ 7.5ms</span>\n</div><div class=\"line\"><a id=\"l-129\" name=\"l-129\"></a><span class=\"linenos\">129</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-130\" name=\"l-130\"></a><span class=\"linenos\">130</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">resultsReceived</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">resultsExpected</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-131\" name=\"l-131\"></a><span class=\"linenos\">131</span><span class=\"w\">    </span><span class=\"n\">cmd_number</span><span class=\"o\">++</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-132\" name=\"l-132\"></a><span class=\"linenos\">132</span><span class=\"w\">  </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-133\" name=\"l-133\"></a><span class=\"linenos\">133</span><span class=\"w\">  </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">clearBuffer</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-134\" name=\"l-134\"></a><span class=\"linenos\">134</span>\n</div><div class=\"line\"><a id=\"l-135\" name=\"l-135\"></a><span class=\"linenos\">135</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">resultsReceived</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">resultsExpected</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-136\" name=\"l-136\"></a><span class=\"linenos\">136</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-137\" name=\"l-137\"></a><span class=\"linenos\">137</span>\n</div><div class=\"line\"><a id=\"l-138\" name=\"l-138\"></a><span class=\"linenos\">138</span><span class=\"kr\">bool</span><span class=\"w\"> </span><span class=\"n\">takeMeasurement</span><span class=\"p\">(</span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">meas_type</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-139\" name=\"l-139\"></a><span class=\"linenos\">139</span><span class=\"w\">  </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">clearBuffer</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-140\" name=\"l-140\"></a><span class=\"linenos\">140</span><span class=\"w\">  </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-141\" name=\"l-141\"></a><span class=\"linenos\">141</span><span class=\"w\">  </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-142\" name=\"l-142\"></a><span class=\"linenos\">142</span><span class=\"w\">  </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"s\">&quot;M&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-143\" name=\"l-143\"></a><span class=\"linenos\">143</span><span class=\"w\">  </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"n\">meas_type</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-144\" name=\"l-144\"></a><span class=\"linenos\">144</span><span class=\"w\">  </span><span class=\"n\">command</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"s\">&quot;!&quot;</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// SDI-12 measurement command format  [address][&#39;M&#39;][!]</span>\n</div><div class=\"line\"><a id=\"l-145\" name=\"l-145\"></a><span class=\"linenos\">145</span><span class=\"w\">  </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">sendCommand</span><span class=\"p\">(</span><span class=\"n\">command</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-146\" name=\"l-146\"></a><span class=\"linenos\">146</span><span class=\"w\">  </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-147\" name=\"l-147\"></a><span class=\"linenos\">147</span>\n</div><div class=\"line\"><a id=\"l-148\" name=\"l-148\"></a><span class=\"linenos\">148</span><span class=\"w\">  </span><span class=\"c1\">// wait for acknowlegement with format [address][ttt (3 char, seconds)][number of</span>\n</div><div class=\"line\"><a id=\"l-149\" name=\"l-149\"></a><span class=\"linenos\">149</span><span class=\"w\">  </span><span class=\"c1\">// measurments available, 0-9]</span>\n</div><div class=\"line\"><a id=\"l-150\" name=\"l-150\"></a><span class=\"linenos\">150</span><span class=\"w\">  </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">sdiResponse</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">readStringUntil</span><span class=\"p\">(</span><span class=\"sc\">&#39;\\n&#39;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-151\" name=\"l-151\"></a><span class=\"linenos\">151</span><span class=\"w\">  </span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">trim</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-152\" name=\"l-152\"></a><span class=\"linenos\">152</span>\n</div><div class=\"line\"><a id=\"l-153\" name=\"l-153\"></a><span class=\"linenos\">153</span><span class=\"w\">  </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">addr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-154\" name=\"l-154\"></a><span class=\"linenos\">154</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-155\" name=\"l-155\"></a><span class=\"linenos\">155</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-156\" name=\"l-156\"></a><span class=\"linenos\">156</span>\n</div><div class=\"line\"><a id=\"l-157\" name=\"l-157\"></a><span class=\"linenos\">157</span><span class=\"w\">  </span><span class=\"c1\">// find out how long we have to wait (in seconds).</span>\n</div><div class=\"line\"><a id=\"l-158\" name=\"l-158\"></a><span class=\"linenos\">158</span><span class=\"w\">  </span><span class=\"kr\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">wait</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"p\">).</span><span class=\"n\">toInt</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-159\" name=\"l-159\"></a><span class=\"linenos\">159</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">wait</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-160\" name=\"l-160\"></a><span class=\"linenos\">160</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-161\" name=\"l-161\"></a><span class=\"linenos\">161</span>\n</div><div class=\"line\"><a id=\"l-162\" name=\"l-162\"></a><span class=\"linenos\">162</span><span class=\"w\">  </span><span class=\"c1\">// Set up the number of results to expect</span>\n</div><div class=\"line\"><a id=\"l-163\" name=\"l-163\"></a><span class=\"linenos\">163</span><span class=\"w\">  </span><span class=\"kr\">int</span><span class=\"w\"> </span><span class=\"n\">numResults</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">sdiResponse</span><span class=\"p\">.</span><span class=\"n\">substring</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">).</span><span class=\"n\">toInt</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-164\" name=\"l-164\"></a><span class=\"linenos\">164</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">numResults</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-165\" name=\"l-165\"></a><span class=\"linenos\">165</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-166\" name=\"l-166\"></a><span class=\"linenos\">166</span>\n</div><div class=\"line\"><a id=\"l-167\" name=\"l-167\"></a><span class=\"linenos\">167</span><span class=\"w\">  </span><span class=\"kr\">unsigned</span><span class=\"w\"> </span><span class=\"kr\">long</span><span class=\"w\"> </span><span class=\"n\">timerStart</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">millis</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-168\" name=\"l-168\"></a><span class=\"linenos\">168</span><span class=\"w\">  </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">((</span><span class=\"nf\">millis</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">timerStart</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"mi\">1000</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">wait</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-169\" name=\"l-169\"></a><span class=\"linenos\">169</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">available</span><span class=\"p\">())</span><span class=\"w\">  </span><span class=\"c1\">// sensor can interrupt us to let us know it is done early</span>\n</div><div class=\"line\"><a id=\"l-170\" name=\"l-170\"></a><span class=\"linenos\">170</span><span class=\"w\">    </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-171\" name=\"l-171\"></a><span class=\"linenos\">171</span><span class=\"w\">      </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"nf\">millis</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">timerStart</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-172\" name=\"l-172\"></a><span class=\"linenos\">172</span><span class=\"w\">      </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-173\" name=\"l-173\"></a><span class=\"linenos\">173</span><span class=\"w\">      </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">clearBuffer</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-174\" name=\"l-174\"></a><span class=\"linenos\">174</span><span class=\"w\">      </span><span class=\"k\">break</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-175\" name=\"l-175\"></a><span class=\"linenos\">175</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-176\" name=\"l-176\"></a><span class=\"linenos\">176</span><span class=\"w\">  </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-177\" name=\"l-177\"></a><span class=\"linenos\">177</span><span class=\"w\">  </span><span class=\"c1\">// Wait for anything else and clear it out</span>\n</div><div class=\"line\"><a id=\"l-178\" name=\"l-178\"></a><span class=\"linenos\">178</span><span class=\"w\">  </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">30</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-179\" name=\"l-179\"></a><span class=\"linenos\">179</span><span class=\"w\">  </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">clearBuffer</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-180\" name=\"l-180\"></a><span class=\"linenos\">180</span>\n</div><div class=\"line\"><a id=\"l-181\" name=\"l-181\"></a><span class=\"linenos\">181</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">numResults</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">getResults</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">numResults</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-182\" name=\"l-182\"></a><span class=\"linenos\">182</span>\n</div><div class=\"line\"><a id=\"l-183\" name=\"l-183\"></a><span class=\"linenos\">183</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"kr\">true</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-184\" name=\"l-184\"></a><span class=\"linenos\">184</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-185\" name=\"l-185\"></a><span class=\"linenos\">185</span>\n</div><div class=\"line\"><a id=\"l-186\" name=\"l-186\"></a><span class=\"linenos\">186</span><span class=\"c1\">// this checks for activity at a particular address</span>\n</div><div class=\"line\"><a id=\"l-187\" name=\"l-187\"></a><span class=\"linenos\">187</span><span class=\"c1\">// expects a char, &#39;0&#39;-&#39;9&#39;, &#39;a&#39;-&#39;z&#39;, or &#39;A&#39;-&#39;Z&#39;</span>\n</div><div class=\"line\"><a id=\"l-188\" name=\"l-188\"></a><span class=\"linenos\">188</span><span class=\"kr\">boolean</span><span class=\"w\"> </span><span class=\"n\">checkActive</span><span class=\"p\">(</span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-189\" name=\"l-189\"></a><span class=\"linenos\">189</span><span class=\"w\">  </span><span class=\"kr\">String</span><span class=\"w\"> </span><span class=\"n\">myCommand</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-190\" name=\"l-190\"></a><span class=\"linenos\">190</span><span class=\"w\">  </span><span class=\"n\">myCommand</span><span class=\"w\">        </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">&quot;&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-191\" name=\"l-191\"></a><span class=\"linenos\">191</span><span class=\"w\">  </span><span class=\"n\">myCommand</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kr\">char</span><span class=\"p\">)</span><span class=\"n\">i</span><span class=\"p\">;</span><span class=\"w\">  </span><span class=\"c1\">// sends basic &#39;acknowledge&#39; command [address][!]</span>\n</div><div class=\"line\"><a id=\"l-192\" name=\"l-192\"></a><span class=\"linenos\">192</span><span class=\"w\">  </span><span class=\"n\">myCommand</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"s\">&quot;!&quot;</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-193\" name=\"l-193\"></a><span class=\"linenos\">193</span>\n</div><div class=\"line\"><a id=\"l-194\" name=\"l-194\"></a><span class=\"linenos\">194</span><span class=\"w\">  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kr\">int</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">j</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">  </span><span class=\"c1\">// goes through three rapid contact attempts</span>\n</div><div class=\"line\"><a id=\"l-195\" name=\"l-195\"></a><span class=\"linenos\">195</span><span class=\"w\">    </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">sendCommand</span><span class=\"p\">(</span><span class=\"n\">myCommand</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-196\" name=\"l-196\"></a><span class=\"linenos\">196</span><span class=\"w\">    </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-197\" name=\"l-197\"></a><span class=\"linenos\">197</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">available</span><span class=\"p\">())</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">  </span><span class=\"c1\">// If we here anything, assume we have an active sensor</span>\n</div><div class=\"line\"><a id=\"l-198\" name=\"l-198\"></a><span class=\"linenos\">198</span><span class=\"w\">      </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">clearBuffer</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-199\" name=\"l-199\"></a><span class=\"linenos\">199</span><span class=\"w\">      </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"kr\">true</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-200\" name=\"l-200\"></a><span class=\"linenos\">200</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-201\" name=\"l-201\"></a><span class=\"linenos\">201</span><span class=\"w\">  </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-202\" name=\"l-202\"></a><span class=\"linenos\">202</span><span class=\"w\">  </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">clearBuffer</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-203\" name=\"l-203\"></a><span class=\"linenos\">203</span><span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"kr\">false</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-204\" name=\"l-204\"></a><span class=\"linenos\">204</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-205\" name=\"l-205\"></a><span class=\"linenos\">205</span>\n</div><div class=\"line\"><a id=\"l-206\" name=\"l-206\"></a><span class=\"linenos\">206</span><span class=\"kr\">void</span><span class=\"w\"> </span><span class=\"nb\">setup</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-207\" name=\"l-207\"></a><span class=\"linenos\">207</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">begin</span><span class=\"p\">(</span><span class=\"n\">serialBaud</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-208\" name=\"l-208\"></a><span class=\"linenos\">208</span><span class=\"w\">  </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nf\">Serial</span><span class=\"p\">)</span>\n</div><div class=\"line\"><a id=\"l-209\" name=\"l-209\"></a><span class=\"linenos\">209</span><span class=\"w\">    </span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-210\" name=\"l-210\"></a><span class=\"linenos\">210</span>\n</div><div class=\"line\"><a id=\"l-211\" name=\"l-211\"></a><span class=\"linenos\">211</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"s\">&quot;Opening SDI-12 bus...&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-212\" name=\"l-212\"></a><span class=\"linenos\">212</span><span class=\"w\">  </span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"nf\">begin</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-213\" name=\"l-213\"></a><span class=\"linenos\">213</span><span class=\"w\">  </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">500</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// allow things to settle</span>\n</div><div class=\"line\"><a id=\"l-214\" name=\"l-214\"></a><span class=\"linenos\">214</span>\n</div><div class=\"line\"><a id=\"l-215\" name=\"l-215\"></a><span class=\"linenos\">215</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"s\">&quot;Timeout value: &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-216\" name=\"l-216\"></a><span class=\"linenos\">216</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">mySDI12</span><span class=\"p\">.</span><span class=\"n\">TIMEOUT</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-217\" name=\"l-217\"></a><span class=\"linenos\">217</span>\n</div><div class=\"line\"><a id=\"l-218\" name=\"l-218\"></a><span class=\"linenos\">218</span><span class=\"w\">  </span><span class=\"c1\">// Power the sensors;</span>\n</div><div class=\"line\"><a id=\"l-219\" name=\"l-219\"></a><span class=\"linenos\">219</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">powerPin</span><span class=\"w\"> </span><span class=\"o\">&gt;=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-220\" name=\"l-220\"></a><span class=\"linenos\">220</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"s\">&quot;Powering up sensors...&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-221\" name=\"l-221\"></a><span class=\"linenos\">221</span><span class=\"w\">    </span><span class=\"nf\">pinMode</span><span class=\"p\">(</span><span class=\"n\">powerPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">OUTPUT</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-222\" name=\"l-222\"></a><span class=\"linenos\">222</span><span class=\"w\">    </span><span class=\"nf\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">powerPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">HIGH</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-223\" name=\"l-223\"></a><span class=\"linenos\">223</span><span class=\"w\">    </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">200</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-224\" name=\"l-224\"></a><span class=\"linenos\">224</span><span class=\"w\">  </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-225\" name=\"l-225\"></a><span class=\"linenos\">225</span>\n</div><div class=\"line\"><a id=\"l-226\" name=\"l-226\"></a><span class=\"linenos\">226</span><span class=\"w\">  </span><span class=\"c1\">// Enable interrupts for the recieve pin</span>\n</div><div class=\"line\"><a id=\"l-227\" name=\"l-227\"></a><span class=\"linenos\">227</span><span class=\"w\">  </span><span class=\"nf\">pinMode</span><span class=\"p\">(</span><span class=\"n\">dataPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kr\">INPUT_PULLUP</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-228\" name=\"l-228\"></a><span class=\"linenos\">228</span><span class=\"w\">  </span><span class=\"n\">enableInterrupt</span><span class=\"p\">(</span><span class=\"n\">dataPin</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">SDI12</span><span class=\"o\">::</span><span class=\"n\">handleInterrupt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">CHANGE</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-229\" name=\"l-229\"></a><span class=\"linenos\">229</span>\n</div><div class=\"line\"><a id=\"l-230\" name=\"l-230\"></a><span class=\"linenos\">230</span><span class=\"w\">  </span><span class=\"c1\">// Quickly Scan the Address Space</span>\n</div><div class=\"line\"><a id=\"l-231\" name=\"l-231\"></a><span class=\"linenos\">231</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"s\">&quot;Scanning all addresses, please wait...&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-232\" name=\"l-232\"></a><span class=\"linenos\">232</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"s\">&quot;Protocol Version, Sensor Address, Sensor Vendor, Sensor Model, &quot;</span>\n</div><div class=\"line\"><a id=\"l-233\" name=\"l-233\"></a><span class=\"linenos\">233</span><span class=\"w\">                 </span><span class=\"s\">&quot;Sensor Version, Sensor ID&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-234\" name=\"l-234\"></a><span class=\"linenos\">234</span>\n</div><div class=\"line\"><a id=\"l-235\" name=\"l-235\"></a><span class=\"linenos\">235</span><span class=\"w\">  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kr\">byte</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">firstAddress</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">lastAddress</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-236\" name=\"l-236\"></a><span class=\"linenos\">236</span><span class=\"w\">    </span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">addr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">decToChar</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-237\" name=\"l-237\"></a><span class=\"linenos\">237</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">checkActive</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-238\" name=\"l-238\"></a><span class=\"linenos\">238</span><span class=\"w\">      </span><span class=\"n\">numSensors</span><span class=\"o\">++</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-239\" name=\"l-239\"></a><span class=\"linenos\">239</span><span class=\"w\">      </span><span class=\"n\">isActive</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">;</span>\n</div><div class=\"line\"><a id=\"l-240\" name=\"l-240\"></a><span class=\"linenos\">240</span><span class=\"w\">      </span><span class=\"n\">printInfo</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-241\" name=\"l-241\"></a><span class=\"linenos\">241</span><span class=\"w\">      </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-242\" name=\"l-242\"></a><span class=\"linenos\">242</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-243\" name=\"l-243\"></a><span class=\"linenos\">243</span><span class=\"w\">  </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-244\" name=\"l-244\"></a><span class=\"linenos\">244</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;Total number of sensors found:  &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-245\" name=\"l-245\"></a><span class=\"linenos\">245</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"n\">numSensors</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-246\" name=\"l-246\"></a><span class=\"linenos\">246</span>\n</div><div class=\"line\"><a id=\"l-247\" name=\"l-247\"></a><span class=\"linenos\">247</span><span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">numSensors</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-248\" name=\"l-248\"></a><span class=\"linenos\">248</span><span class=\"w\">    </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-249\" name=\"l-249\"></a><span class=\"linenos\">249</span><span class=\"w\">      </span><span class=\"s\">&quot;No sensors found, please check connections and restart the Arduino.&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-250\" name=\"l-250\"></a><span class=\"linenos\">250</span><span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kr\">true</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">);</span><span class=\"w\"> </span><span class=\"p\">}</span><span class=\"w\">  </span><span class=\"c1\">// do nothing forever</span>\n</div><div class=\"line\"><a id=\"l-251\" name=\"l-251\"></a><span class=\"linenos\">251</span><span class=\"w\">  </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-252\" name=\"l-252\"></a><span class=\"linenos\">252</span>\n</div><div class=\"line\"><a id=\"l-253\" name=\"l-253\"></a><span class=\"linenos\">253</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-254\" name=\"l-254\"></a><span class=\"linenos\">254</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span><span class=\"s\">&quot;Time Elapsed (s), Est Measurement Time (s), Number Measurements, &quot;</span>\n</div><div class=\"line\"><a id=\"l-255\" name=\"l-255\"></a><span class=\"linenos\">255</span><span class=\"w\">                 </span><span class=\"s\">&quot;Real Measurement Time (ms), Measurement 1, Measurement 2, ... etc.&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-256\" name=\"l-256\"></a><span class=\"linenos\">256</span><span class=\"w\">  </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">(</span>\n</div><div class=\"line\"><a id=\"l-257\" name=\"l-257\"></a><span class=\"linenos\">257</span><span class=\"w\">    </span><span class=\"s\">&quot;-------------------------------------------------------------------------------&quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-258\" name=\"l-258\"></a><span class=\"linenos\">258</span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-259\" name=\"l-259\"></a><span class=\"linenos\">259</span>\n</div><div class=\"line\"><a id=\"l-260\" name=\"l-260\"></a><span class=\"linenos\">260</span><span class=\"kr\">void</span><span class=\"w\"> </span><span class=\"nb\">loop</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-261\" name=\"l-261\"></a><span class=\"linenos\">261</span><span class=\"w\">  </span><span class=\"c1\">// measure one at a time</span>\n</div><div class=\"line\"><a id=\"l-262\" name=\"l-262\"></a><span class=\"linenos\">262</span><span class=\"w\">  </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kr\">byte</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">firstAddress</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">lastAddress</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-263\" name=\"l-263\"></a><span class=\"linenos\">263</span><span class=\"w\">    </span><span class=\"kr\">char</span><span class=\"w\"> </span><span class=\"n\">addr</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">decToChar</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-264\" name=\"l-264\"></a><span class=\"linenos\">264</span><span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">isActive</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">])</span><span class=\"w\"> </span><span class=\"p\">{</span>\n</div><div class=\"line\"><a id=\"l-265\" name=\"l-265\"></a><span class=\"linenos\">265</span><span class=\"w\">      </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"nf\">millis</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">/</span><span class=\"w\"> </span><span class=\"mi\">1000</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-266\" name=\"l-266\"></a><span class=\"linenos\">266</span><span class=\"w\">      </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"s\">&quot;, &quot;</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-267\" name=\"l-267\"></a><span class=\"linenos\">267</span><span class=\"w\">      </span><span class=\"n\">takeMeasurement</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">);</span>\n</div><div class=\"line\"><a id=\"l-268\" name=\"l-268\"></a><span class=\"linenos\">268</span><span class=\"w\">      </span><span class=\"nf\">Serial</span><span class=\"p\">.</span><span class=\"nf\">println</span><span class=\"p\">();</span>\n</div><div class=\"line\"><a id=\"l-269\" name=\"l-269\"></a><span class=\"linenos\">269</span><span class=\"w\">    </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-270\" name=\"l-270\"></a><span class=\"linenos\">270</span><span class=\"w\">  </span><span class=\"p\">}</span>\n</div><div class=\"line\"><a id=\"l-271\" name=\"l-271\"></a><span class=\"linenos\">271</span>\n</div><div class=\"line\"><a id=\"l-272\" name=\"l-272\"></a><span class=\"linenos\">272</span><span class=\"w\">  </span><span class=\"nf\">delay</span><span class=\"p\">(</span><span class=\"mi\">10000</span><span class=\"p\">);</span><span class=\"w\">  </span><span class=\"c1\">// wait ten seconds between measurement attempts.</span>\n</div><div class=\"line\"><a id=\"l-273\" name=\"l-273\"></a><span class=\"linenos\">273</span><span class=\"p\">}</span>\n</div></div></div></section>",
    "sections": [],
    "deprecated": null,
    "since": null,
    "example_navigation": null,
    "footer_navigation": null,
    "topics": [],
    "dirs": [],
    "files": [],
    "namespaces": [],
    "classes": [],
    "base_classes": [],
    "derived_classes": [],
    "enums": [],
    "typedefs": [],
    "funcs": [],
    "vars": [],
    "defines": [],
    "public_types": [],
    "public_static_funcs": [],
    "typeless_funcs": [],
    "public_funcs": [],
    "signals": [],
    "public_slots": [],
    "public_static_vars": [],
    "public_vars": [],
    "protected_types": [],
    "protected_static_funcs": [],
    "protected_funcs": [],
    "protected_slots": [],
    "protected_static_vars": [],
    "protected_vars": [],
    "private_funcs": [],
    "private_slots": [],
    "related": [],
    "friend_funcs": [],
    "groups": [],
    "has_enum_details": false,
    "has_typedef_details": false,
    "has_func_details": false,
    "has_var_details": false,
    "has_define_details": false,
    "breadcrumb": [
      [
        "Examples using the SDI-12 Library",
        "examples_page.html"
      ],
      [
        "Example J: Using External Interrupts",
        "example_j_page.html"
      ]
    ],
    "breadcrumbGroup": [
      [
        "Example J: Using External Interrupts",
        "example_j_page.html"
      ]
    ]
  }
}